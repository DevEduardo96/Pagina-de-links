<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="pageTitle">Perfil - Links</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
  </head>
  <body
    class="bg-[#0a0e1a] text-white min-h-screen overflow-x-hidden relative font-sans"
  >
    <!-- Background elements -->
    <div class="fixed inset-0 pointer-events-none z-0">
      <div
        class="absolute top-[20%] left-[-100px] w-[300px] h-[1px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-30 animate-pulse"
      ></div>
      <div
        class="absolute top-[60%] right-[-100px] w-[250px] h-[1px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-30 animate-pulse delay-1000"
      ></div>
      <div
        class="absolute top-[80%] left-[10%] w-[200px] h-[1px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent opacity-30 animate-pulse delay-2000"
      ></div>
      <div
        class="absolute top-[25%] left-[15%] w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_#00bfff] animate-ping delay-[500ms]"
      ></div>
      <div
        class="absolute top-[45%] right-[20%] w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_#00bfff] animate-ping delay-[1500ms]"
      ></div>
      <div
        class="absolute top-[70%] left-[25%] w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_#00bfff] animate-ping delay-[2500ms]"
      ></div>
      <div
        class="absolute top-[85%] right-[30%] w-1.5 h-1.5 bg-cyan-400 rounded-full shadow-[0_0_10px_#00bfff] animate-ping delay-[3500ms]"
      ></div>
    </div>

    <!-- Loading Screen -->
    <div
      id="loadingScreen"
      class="relative z-10 max-w-md mx-auto py-20 px-5 text-center"
    >
      <div
        class="animate-spin w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full mx-auto mb-4"
      ></div>
      <p class="text-gray-400">Carregando perfil...</p>
    </div>

    <!-- Error Screen -->
    <div
      id="errorScreen"
      class="hidden relative z-10 max-w-md mx-auto py-20 px-5 text-center"
    >
      <div class="text-6xl mb-4">üòï</div>
      <h1 class="text-2xl font-bold text-red-400 mb-2">
        Perfil n√£o encontrado
      </h1>
      <p class="text-gray-400">
        Este perfil n√£o existe ou n√£o est√° dispon√≠vel.
      </p>
    </div>

    <!-- Main content -->
    <div
      id="mainContent"
      class="hidden relative z-10 max-w-md mx-auto py-10 px-5 text-center"
    >
      <div class="mb-10 animate-fade-down">
        <div
          id="userAvatar"
          class="w-24 h-24 mx-auto mb-5 rounded-full flex items-center justify-center bg-gradient-to-br from-cyan-400 to-blue-600 text-4xl shadow-[0_0_30px_rgba(0,191,255,0.3)] animate-pulse overflow-hidden"
        >
          <span id="userInitials">U</span>
        </div>
        <h1
          id="userName"
          class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-white bg-clip-text text-transparent"
        >
          Carregando...
        </h1>
        <p
          id="userDescription"
          class="text-sm text-gray-400 mt-2 leading-relaxed"
        >
          Carregando descri√ß√£o...
        </p>
        <p class="text-base text-cyan-400 mt-6 font-semibold">
          Links de contato:
        </p>
      </div>

      <div class="flex flex-col gap-4 mb-10">
        <div id="linksContainer">
          <!-- Os links carregados do Supabase aparecer√£o aqui -->
        </div>
      </div>

      <!-- Social Media Links (Links do tipo 'social' aparecer√£o aqui) -->
      <div
        id="socialContainer"
        class="flex justify-center gap-6 animate-fade-up"
      >
        <!-- Links sociais aparecer√£o aqui -->
      </div>
    </div>

    <script>
      // Configura√ß√£o do Supabase
      const SUPABASE_URL = "https://mfuiqabijexayjoelqrx.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1mdWlxYWJpamV4YXlqb2VscXJ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM0NTIxMzMsImV4cCI6MjA2OTAyODEzM30._vU2hLj5wJyEi4ggKV3zOWdtoIUd_PAhCEZWPce4WXU";

      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      // Debug - verificar se Supabase foi carregado
      console.log("Supabase carregado:", !!window.supabase);
      console.log("Cliente criado:", !!supabase);

      // Fun√ß√£o para obter par√¢metros da URL
      function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
      }

      // Fun√ß√£o para mostrar telas
      function showScreen(screenId) {
        document.getElementById("loadingScreen").style.display = "none";
        document.getElementById("errorScreen").classList.add("hidden");
        document.getElementById("mainContent").classList.add("hidden");

        if (screenId === "loading") {
          document.getElementById("loadingScreen").style.display = "block";
        } else if (screenId === "error") {
          document.getElementById("errorScreen").classList.remove("hidden");
        } else if (screenId === "main") {
          document.getElementById("mainContent").classList.remove("hidden");
        }
      }

      // Fun√ß√£o para carregar perfil do usu√°rio
      async function loadUserProfile(userId) {
        try {
          console.log("Buscando perfil para userId:", userId);

          const { data: profile, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("user_id", userId)
            .single();

          console.log("Resultado da busca perfil:", { data: profile, error });

          if (error && error.code !== "PGRST116") {
            console.error("Erro na consulta perfil:", error);
            throw error;
          }

          // Se n√£o houver perfil, retornar dados padr√£o
          if (!profile || error?.code === "PGRST116") {
            console.log("Perfil n√£o encontrado, usando dados padr√£o");
            return {
              name: "Usu√°rio",
              description: "Perfil em constru√ß√£o...",
              photo_url: null,
            };
          }

          return profile;
        } catch (error) {
          console.error("Erro ao carregar perfil:", error);
          // Retornar dados padr√£o em caso de erro
          return {
            name: "Usu√°rio",
            description: "Perfil em constru√ß√£o...",
            photo_url: null,
          };
        }
      }

      // Fun√ß√£o para carregar links do usu√°rio
      async function loadUserLinks(userId) {
        try {
          console.log("Buscando links para userId:", userId);

          const { data: links, error } = await supabase
            .from("links")
            .select("*")
            .eq("user_id", userId)
            .order("created_at", { ascending: false });

          console.log("Resultado da busca links:", { data: links, error });

          if (error) {
            console.error("Erro na consulta links:", error);
            return []; // Retornar array vazio em caso de erro
          }

          return links || [];
        } catch (error) {
          console.error("Erro ao carregar links:", error);
          return [];
        }
      }

      // Fun√ß√£o para renderizar perfil
      function renderProfile(profile) {
        const userName = profile.name || "Usu√°rio";
        const userDescription =
          profile.description || "Perfil em constru√ß√£o...";
        const userPhoto = profile.photo_url;

        // Atualizar t√≠tulo da p√°gina
        document.getElementById(
          "pageTitle"
        ).textContent = `${userName} - Links`;
        document.title = `${userName} - Links`;

        // Atualizar nome
        document.getElementById("userName").textContent = userName;

        // Atualizar descri√ß√£o
        document.getElementById("userDescription").textContent =
          userDescription;

        // Atualizar avatar
        const avatarContainer = document.getElementById("userAvatar");
        const initialsElement = document.getElementById("userInitials");

        if (userPhoto) {
          avatarContainer.innerHTML = `<img src="${userPhoto}" alt="${userName}" class="w-full h-full object-cover rounded-full">`;
        } else {
          const initials = userName
            .split(" ")
            .map((n) => n[0])
            .join("")
            .toUpperCase()
            .substring(0, 2);
          initialsElement.textContent = initials;
        }
      }

      // Fun√ß√£o para renderizar links
      function renderLinks(links) {
        const linksContainer = document.getElementById("linksContainer");
        const socialContainer = document.getElementById("socialContainer");

        // Separar links por tipo
        const mainLinks = links.filter((link) => link.type !== "social");
        const socialLinks = links.filter((link) => link.type === "social");

        // Renderizar links principais
        if (mainLinks.length === 0) {
          linksContainer.innerHTML = `
            <div class="text-center py-8">
              <div class="text-4xl mb-4">üîó</div>
              <p class="text-gray-400">Nenhum link dispon√≠vel</p>
            </div>
          `;
        } else {
          linksContainer.innerHTML = "";
          mainLinks.forEach((link) => {
            const linkElement = document.createElement("a");
            linkElement.href = link.url;
            linkElement.target = "_blank";
            linkElement.rel = "noopener noreferrer";
            linkElement.className =
              "link-button bg-gradient-to-br from-blue-900 to-blue-500 border-2 border-cyan-400 rounded-xl py-4 px-6 text-white font-bold text-lg flex items-center justify-center gap-2 hover:scale-[1.02] hover:shadow-lg hover:border-white transition mb-3 transform hover:shadow-[0_0_20px_rgba(0,191,255,0.3)]";

            linkElement.innerHTML = `
              <span class="text-xl">${link.icon || "üîó"}</span> 
              <span>${link.title}</span>
            `;

            linksContainer.appendChild(linkElement);
          });
        }

        // Renderizar links sociais
        if (socialLinks.length > 0) {
          socialContainer.innerHTML = "";
          socialLinks.forEach((link) => {
            const socialElement = document.createElement("a");
            socialElement.href = link.url;
            socialElement.target = "_blank";
            socialElement.rel = "noopener noreferrer";
            socialElement.title = link.title;
            socialElement.className =
              "w-12 h-12 rounded-full flex items-center justify-center text-white text-xl bg-gradient-to-br from-pink-500 via-purple-600 to-indigo-600 hover:scale-110 hover:shadow-lg transition transform hover:shadow-[0_0_15px_rgba(168,85,247,0.4)]";

            socialElement.innerHTML = `<span>${link.icon || "üîó"}</span>`;

            socialContainer.appendChild(socialElement);
          });
        } else {
          // Links padr√£o se n√£o houver links sociais
          socialContainer.innerHTML = `
            <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl bg-gradient-to-br from-pink-500 via-purple-600 to-indigo-600 opacity-50">
              üì∑
            </div>
            <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl bg-blue-600 opacity-50">
              üìò
            </div>
            <div class="w-12 h-12 rounded-full flex items-center justify-center text-white text-xl bg-red-600 opacity-50">
              üì∫
            </div>
          `;
        }
      }

      // Fun√ß√£o principal para carregar p√°gina
      async function loadPage() {
        console.log("Iniciando carregamento da p√°gina...");
        showScreen("loading");

        // Obter ID do usu√°rio da URL
        const userId = getUrlParameter("user");
        console.log("User ID da URL:", userId);

        if (!userId) {
          console.log("Nenhum User ID encontrado na URL");
          showScreen("error");
          return;
        }

        try {
          console.log("Carregando dados do usu√°rio:", userId);

          // Carregar perfil e links
          const [profile, links] = await Promise.all([
            loadUserProfile(userId),
            loadUserLinks(userId),
          ]);

          console.log("Perfil carregado:", profile);
          console.log("Links carregados:", links);

          if (!profile) {
            console.log("Perfil n√£o encontrado");
            showScreen("error");
            return;
          }

          // Renderizar conte√∫do
          renderProfile(profile);
          renderLinks(links);

          // Mostrar conte√∫do principal
          showScreen("main");
          console.log("P√°gina carregada com sucesso!");
        } catch (error) {
          console.error("Erro ao carregar p√°gina:", error);
          showScreen("error");
        }
      }

      // Carregar p√°gina quando DOM estiver pronto
      document.addEventListener("DOMContentLoaded", function () {
        console.log("DOM carregado, iniciando...");

        // Aguardar um pouco para garantir que o Supabase foi carregado
        setTimeout(loadPage, 500);
      });

      // Fallback caso DOMContentLoaded j√° tenha disparado
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", loadPage);
      } else {
        setTimeout(loadPage, 500);
      }
    </script>
  </body>
</html>
